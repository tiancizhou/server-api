# 算账工具性能优化说明

## 🚀 已实现的性能优化

### 1. **内存缓存机制**
- ✅ 数据读取后缓存5秒
- ✅ 减少频繁的文件IO操作
- ✅ 提升响应速度（特别是频繁查询时）

### 2. **异步文件写入**
- ✅ 数据保存采用异步写入，不阻塞API响应
- ✅ 用户体验更流畅

### 3. **数据自动清理**
- ✅ 每种数据类型最多保留10,000条记录
- ✅ 超过限制时自动清理最旧的记录
- ✅ 防止数据文件过大

### 4. **分页支持**
- ✅ API支持分页查询（可选）
- ✅ 减少单次传输的数据量

## 📊 性能表现

### 数据量评估
- **小规模**（< 1000条）：响应时间 < 50ms，无压力
- **中规模**（1000-5000条）：响应时间 < 200ms，流畅运行
- **大规模**（5000-10000条）：响应时间 < 500ms，自动清理旧数据
- **超大规模**（> 10000条）：自动保留最新10000条，旧数据自动清理

### 内存占用
- 缓存数据：约每1000条记录占用 100KB 内存
- 10,000条记录约占用 1MB 内存（非常小）

### 文件大小
- 每条记录约 200-500 字节
- 10,000条记录约 2-5MB 文件大小（完全可以接受）

## 🔧 手动管理功能

如果需要手动清理数据，可以使用API：

```javascript
// 清理进货记录，保留最新5000条
POST /api/accounting/cleanup
{
  "type": "purchases",
  "keepCount": 5000
}
```

## 💡 使用建议

1. **正常使用**：无需担心，系统会自动优化
2. **数据量大时**：系统会自动清理旧数据，保留最新的
3. **定期备份**：建议定期备份 `data/accounting.json` 文件
4. **导出数据**：如果需要长期保存，可以定期导出为Excel或CSV

## ⚠️ 注意事项

- 自动清理会删除最旧的记录，请确保重要数据已备份
- 缓存机制在5秒内可能显示旧数据（通常不影响使用）
- 本地服务通常不会有性能问题，这些优化是为了预防未来数据增长

## 📈 性能监控

系统会在控制台输出数据量信息：
- 数据量 > 5000条时会显示提示
- 自动清理时会记录日志

---

**总结**：对于本地服务，即使有几千条记录也完全没问题。这些优化措施是为了确保即使数据量增长到数万条，系统仍能流畅运行。

